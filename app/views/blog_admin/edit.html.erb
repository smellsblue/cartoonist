<p>
  <a href="/blog_admin/<%= @post.url_title %>/preview">Preview this post</a>
</p>

<p>
  <%= form_tag "/blog_admin/#{@post.id}/#{lock_toggle_target}", :method => :post do %>
    <input type="submit" value="<%= lock_toggle_target %>" />
  <% end %>
</p>

<%= form_tag "/blog_admin/#{@post.id}", :method => :put do %>
  <p>
    <label><input type="checkbox" name="posted" value="true" <%= checked="checked".html_safe if @post.posted_at %> <%= lock_disabled %> />Posted at</label>
    <input type="text" name="posted_at_date" value="<%= format_posted_at "%Y-%m-%d" %>" <%= lock_disabled %> />
    <select name="posted_at_hour" <%= lock_disabled %>>
      <% 1.upto 12 do |h| %>
        <option value="<%= h %>" <%= selected h, format_posted_at("%-l").to_i %>><%= h %></option>
      <% end %>
    </select>
    <select name="posted_at_minute" <%= lock_disabled %>>
      <% 0.upto 60 do |m| %>
        <option value="<%= m %>" <%= selected m, format_posted_at("%-M").to_i %>><%= m %></option>
      <% end %>
    </select>
    <select name="posted_at_meridiem" <%= lock_disabled %>>
      <option value="am" <%= selected "am", format_posted_at("%P") %>>am</option>
      <option value="pm" <%= selected "pm", format_posted_at("%P") %>>pm</option>
    </select>
  </p>

  <p>
    URL Title: <%= @post.url_title %>
  </p>

  <p>
    Title:
    <input type="text" name="title" size="100" value="<%= @post.title %>" <%= lock_disabled %> />
  </p>

  <p>
    Author:
    <input type="text" name="author" size="20" value="<%= @post.author %>" <%= lock_disabled %> />
  </p>

  <p>
    Tweet:
    <% if @post.tweeted_at %>
      <em>(sent <%= @post.tweeted_at.strftime "%-m/%-d/%Y %-l:%M %P" %>)</em>
    <% end %>
    <br />
    <textarea name="tweet" rows="2" cols="100" tabindex="5" <%= lock_disabled %>><%= @post.tweet %></textarea>
  </p>

  <p>
    <input type="submit" value="Save" <%= lock_disabled %> />
    <input type="button" value="Preview" class="preview-content" />
  </p>

  <p>
    Content:<br />
    <textarea name="content" rows="20" cols="100" <%= lock_disabled %>><%= @post.content %></textarea><br />
  </p>

  <p>
    <input type="submit" value="Save" <%= lock_disabled %> />
    <input type="button" value="Preview" class="preview-content" />
  </p>
<% end %>

<hr />

<div class="preview-content">
</div>

<%= javascript_include_tag "https://ajax.googleapis.com/ajax/libs/jquery/1.7.1/jquery.min.js" %>
<%= javascript_include_tag "https://ajax.googleapis.com/ajax/libs/jqueryui/1.8.18/jquery-ui.min.js" %>
<%= stylesheet_link_tag "http://ajax.googleapis.com/ajax/libs/jqueryui/1.8.17/themes/base/jquery-ui.css" %>
<%= javascript_tag do %>
  $(function() {
    $("input[name='posted_at_date']").datepicker({ dateFormat: "yy-mm-dd" });
    $(".preview-content").click(function() {
      var $this = $(this).attr("disabled", "disabled");
      $.ajax({
        url: "/blog_admin/preview_content",
        type: "post",
        data: {
          authenticity_token: $("form input[name='authenticity_token']").val(),
          content: $("textarea[name='content']").val()
        },
        dataType: "text",
        success: function(text) {
          $(".preview-content").html(text);
          $this.removeAttr("disabled");
        },
        error: function() {
          $(".preview-content").html('<div style="color: red;">There was an error.</div>');
          $this.removeAttr("disabled");
        }
      });
      return false;
    });
  });
<% end %>
